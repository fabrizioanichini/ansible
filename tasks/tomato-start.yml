- name: Ensure ~/tomatoai/front directory exists
  file:
    path: "{{ lookup('env', 'HOME') }}/tomatoai/front"
    state: directory

- name: Clone tomato-frontend-2.0 repository into front folder
  git:
    repo: 'git@github.com-tomatoai:tomatoai-dev/tomato-frontend-2.0.git'
    dest: "{{ lookup('env', 'HOME') }}/tomatoai/front"
    version: dev

- name: Run npm install in front folder
  command: npm install
  args:
    chdir: "{{ lookup('env', 'HOME') }}/tomatoai/front"

- name: Copy .env.example to .env in front folder
  copy:
    src: "{{ lookup('env', 'HOME') }}/tomatoai/front/.env.example"
    dest: "{{ lookup('env', 'HOME') }}/tomatoai/front/.env"

- name: Ensure ~/tomatoai/back directory exists
  file:
    path: "{{ lookup('env', 'HOME') }}/tomatoai/back"
    state: directory

- name: Clone tomato-2.0 repository into back folder
  git:
    repo: 'git@github.com-tomatoai:tomatoai-dev/tomato-2.0.git'
    dest: "{{ lookup('env', 'HOME') }}/tomatoai/back"
    version: dev

- name: Copy backend/.env.example to backend/.env in back folder
  copy:
    src: "{{ lookup('env', 'HOME') }}/tomatoai/back/backend/.env.example"
    dest: "{{ lookup('env', 'HOME') }}/tomatoai/back/backend/.env"

- name: Build and start Docker containers in back folder
  docker_compose:
    project_src: "{{ lookup('env', 'HOME') }}/tomatoai/back"
    state: present
    build: yes
    restarted: yes